// https://github.com/yagop/node-telegram-bot-api/issues/319#issuecomment-324963294
// Fixes an error with Promise cancellation
process.env.NTBA_FIX_319 = 'test'

// –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫—É Telegram Bot API
const TelegramBot = require('node-telegram-bot-api')

// –ú–∞—Å—Å–∏–≤ —Å–ª—É—á–∞–π–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
const questions = [
  '–ö–∞–∫ —è –º–æ–≥—É –ø—Ä–∏–∑–Ω–∞—Ç—å, —á—Ç–æ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—è ‚Äî —ç—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞, —Ç—Ä–µ–±—É—é—â–∞—è –≤–Ω–∏–º–∞–Ω–∏—è?',
  '–í —á–µ–º –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –º–æ—è –ª–∏—á–Ω–∞—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é?',
  '–ö–∞–∫–æ–≤—ã –º–æ–∏ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç—Ä–∞—Ö–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏—è, —Å–ø–æ—Å–æ–±—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏?',
  '–ö–∞–∫–∏–µ –ø—Ä–∏–≤—ã—á–∫–∏ –∏ —É–±–µ–∂–¥–µ–Ω–∏—è –ø–æ–¥–ø–∏—Ç—ã–≤–∞—é—Ç –º–æ—é —Å–∫–ª–æ–Ω–Ω–æ—Å—Ç—å –∫ –æ—Ç–∫–ª–∞–¥—ã–≤–∞–Ω–∏—é –¥–µ–ª?',
  '–ö–∞–∫ —è –º–æ–≥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–µ–¥–∏—Ç–∞—Ü–∏—é –¥–ª—è –±–æ—Ä—å–±—ã —Å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π?',
  '–ö–∞–∫ –º–Ω–µ –ø—Ä–∏–Ω—è—Ç—å —Å–≤–æ–∏ –æ—à–∏–±–∫–∏ –≤ –ø—Ä–æ—à–ª–æ–º –∏ –¥–≤–∏–≥–∞—Ç—å—Å—è –≤–ø–µ—Ä–µ–¥?',
  '–ö–∞–∫–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —è –º–æ–≥—É –ø—Ä–µ–¥–ø—Ä–∏–Ω—è—Ç—å, —á—Ç–æ–±—ã –±–æ—Ä–æ—Ç—å—Å—è —Å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π?',
  '–ö–∞–∫ –º–Ω–µ –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —á–µ—Å—Ç–Ω—ã–º —Å —Å–æ–±–æ–π –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ –º–æ–∏—Ö —É—Å–ø–µ—Ö–æ–≤ –∏ –Ω–µ—É–¥–∞—á –≤ —ç—Ç–æ–π –±–æ—Ä—å–±–µ?',
  '–ö–∞–∫ —è –º–æ–≥—É –∏—Å–∫–∞—Ç—å –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –¥–ª—è –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏?',
  '–ö–∞–∫ —è –º–æ–≥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏ –¥–ª—è –ø–æ–º–æ—â–∏ –¥—Ä—É–≥–∏–º –≤ –±–æ—Ä—å–±–µ —Å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π?',
  '–ö–∞–∫ —è –º–æ–≥—É —É–ª—É—á—à–∏—Ç—å —Å–≤–æ–∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è —Å –æ–∫—Ä—É–∂–∞—é—â–∏–º–∏, –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞—è –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏—é?',
  '–ö–∞–∫–∏–µ –¥—É—Ö–æ–≤–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –º–æ–≥—É—Ç –ø–æ–º–æ—á—å –º–Ω–µ –≤ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏?',
  '–ö–∞–∫ —è –º–æ–≥—É –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è —Å–º–∏—Ä–µ–Ω–Ω—ã–º –∏ –æ—Ç–∫—Ä—ã—Ç—ã–º –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –±–æ—Ä—å–±—ã —Å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π?',
  '–ö–∞–∫ —è –º–æ–≥—É –ø—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∏–Ω—Ü–∏–ø—ã 12 —à–∞–≥–æ–≤ –∫ –¥—Ä—É–≥–∏–º –æ–±–ª–∞—Å—Ç—è–º –º–æ–µ–π –∂–∏–∑–Ω–∏?',
  '–ö–∞–∫ –º–Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Å–≤–æ–∏ —É—Å–ø–µ—Ö–∏ –∏ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞—Å—Ç–∏ –≤ –ø—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–∏ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–∏?',
  '–ò—Å—Ç–∏–Ω–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞ –±—ã—Ç—å –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ç–æ—Ä–æ–º, –∏–ª–∏ –∂–µ —ç—Ç–æ –¥—É—Ö–æ–≤–Ω–∞—è –±–æ–ª–µ–∑–Ω—å –º–µ–Ω—è —Ç–∞–∫ –Ω–∞–∫—Ä—É—á–∏–≤–∞–µ—Ç?',
  '–í–° –º–æ–∂–µ—Ç –¥–∞—Ä–æ–≤–∞—Ç—å –Ω–∞–º –°–∏–ª—ã –Ω–µ –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∏—Ä–æ–≤–∞—Ç—å —Å–µ–≥–æ–¥–Ω—è?',
  '–ú–æ–≥–ª–∏ –±—ã –º—ã –ø—Ä–æ—Å–∏—Ç—å –µ–≥–æ –í–æ–ª—é –¥–∞—Ç—å –Ω–∞–º –∑–¥—Ä–∞–≤–æ–º—ã—Å–ª–∏—è –Ω–µ –æ—Ç–∫–ª–∞–¥—ã–≤–∞—Ç—å –¥–µ–ª–∞, –∞ –¥–µ–ª–∞—Ç—å –∏—Ö –≤–æ–≤—Ä–µ–º—è?',
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
]

const ideasWithEmojis = [
  'üìù –°–æ—Å—Ç–∞–≤–∏—Ç—å –ø–ª–∞–Ω –¥–Ω—è',
  'üßò‚Äç‚ôÇÔ∏è –ú–µ–¥–∏—Ç–∞—Ü–∏—è 10 –º–∏–Ω—É—Ç',
  'üèÉ‚Äç‚ôÄÔ∏è –ö–æ—Ä–æ—Ç–∫–∞—è –ø—Ä–æ–±–µ–∂–∫–∞',
  'üìö –ß—Ç–µ–Ω–∏–µ –∫–Ω–∏–≥–∏ –Ω–∞ 20 –º–∏–Ω—É—Ç',
  'üé® –†–∏—Å–æ–≤–∞–Ω–∏–µ –∏–ª–∏ –∑–∞–Ω—è—Ç–∏—è —Ö—É–¥–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ–º',
  'üìî –í–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞',
  'üç≥ –ì–æ—Ç–æ–≤–∫–∞ –Ω–æ–≤–æ–≥–æ –±–ª—é–¥–∞',
  'üß© –°–±–æ—Ä–∫–∞ –ø–∞–∑–ª–∞',
  'üå± –£—Ö–æ–¥ –∑–∞ –∫–æ–º–Ω–∞—Ç–Ω—ã–º–∏ —Ä–∞—Å—Ç–µ–Ω–∏—è–º–∏',
  'üéπ –ò–≥—Ä–∞ –Ω–∞ –º—É–∑—ã–∫–∞–ª—å–Ω–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–µ',
  'üö∂‚Äç‚ôÇÔ∏è –ü—Ä–æ–≥—É–ª–∫–∞ –Ω–∞ —Å–≤–µ–∂–µ–º –≤–æ–∑–¥—É—Ö–µ',
  'üßπ –£–±–æ—Ä–∫–∞ –≤ –∫–æ–º–Ω–∞—Ç–µ',
  'üí™ –ö–æ—Ä–æ—Ç–∫–∞—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞',
  'üíå –ù–∞–ø–∏—Å–∞–Ω–∏–µ –ø–∏—Å—å–º–∞ –¥—Ä—É–≥—É',
  'üì∏ –§–æ—Ç–æ–≥—Ä–∞—Ñ–∏—Ä–æ–≤–∞–Ω–∏–µ',
  'üìÖ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—É–¥—É—â–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π',
  'üß∂ –í—è–∑–∞–Ω–∏–µ –∏–ª–∏ —Ä—É–∫–æ–¥–µ–ª–∏–µ',
  'üéÆ –ò–≥—Ä–∞ –≤ –æ–±—É—á–∞—é—â–∏–µ –∏–≥—Ä—ã',
  'üíº –ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –Ω–∞–≤—ã–∫–æ–≤ –æ–Ω–ª–∞–π–Ω',
  'üåü –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–µ –º–∞–ª–µ–Ω—å–∫–∏—Ö —Ü–µ–ª–µ–π',
  'üé≠ –ü–æ—Å–µ—â–µ–Ω–∏–µ –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π',
  'üö¥‚Äç‚ôÄÔ∏è –í–µ–ª–æ—Å–∏–ø–µ–¥–Ω–∞—è –ø—Ä–æ–≥—É–ª–∫–∞',
  'ü•ó –ü—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –∑–¥–æ—Ä–æ–≤–æ–≥–æ —Å–Ω—ç–∫–∞',
  'üßò‚Äç‚ôÄÔ∏è –ô–æ–≥–∞',
  'üé≤ –ò–≥—Ä—ã –≤ –Ω–∞—Å—Ç–æ–ª—å–Ω—ã–µ –∏–≥—Ä—ã',
  'üìñ –ò–∑—É—á–µ–Ω–∏–µ –∏–Ω–æ—Å—Ç—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞',
  'üå≥ –ü–æ—Å–∞–¥–∫–∞ —Ä–∞—Å—Ç–µ–Ω–∏–π –∏–ª–∏ —É—Ö–æ–¥ –∑–∞ —Å–∞–¥–æ–º',
  'üß© –ì–æ–ª–æ–≤–æ–ª–æ–º–∫–∏',
  'üé• –°–º–æ—Ç—Ä–µ—Ç—å –æ–±—É—á–∞—é—â–∏–µ –≤–∏–¥–µ–æ',
  'üë• –í—Å—Ç—Ä–µ—á–∞ —Å –¥—Ä—É–∑—å—è–º–∏',
  'üõ† –ú–µ–ª–∫–∏–π —Ä–µ–º–æ–Ω—Ç',
  'üé§ –ü–µ–Ω–∏–µ –∏–ª–∏ –∫–∞—Ä–∞–æ–∫–µ',
  'üé® –ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –≤–∏–¥–æ–≤ –∏—Å–∫—É—Å—Å—Ç–≤–∞',
  'üìö –ß—Ç–µ–Ω–∏–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã',
  'üõí –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–∫—É–ø–æ–∫',
  'üßº –°–æ–∑–¥–∞–Ω–∏–µ —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã',
  'üê∂ –ü—Ä–æ–≥—É–ª–∫–∞ —Å –ø–∏—Ç–æ–º—Ü–µ–º',
  'üåê –ò–∑—É—á–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–µ–º –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ',
  'üé• –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–¥–µ–æ –∏–ª–∏ –±–ª–æ–≥–∞',
  'üåç –ò–∑—É—á–µ–Ω–∏–µ –≥–µ–æ–≥—Ä–∞—Ñ–∏–∏ –∏–ª–∏ –∏—Å—Ç–æ—Ä–∏–∏',
  'üöÄ –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞',
  'üìà –ò–∑—É—á–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –∏ –∏–Ω–≤–µ—Å—Ç–∏—Ü–∏–π',
  'üéµ –°–ª—É—à–∞—Ç—å –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–¥–∫–∞—Å—Ç—ã',
  'üåå –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ –∑–≤–µ–∑–¥–∞–º–∏',
  'üèû –ü–æ—Ö–æ–¥—ã –∏ –ø–∏–∫–Ω–∏–∫–∏',
  'üõç –ü–æ—Å–µ—â–µ–Ω–∏–µ –≤—ã—Å—Ç–∞–≤–æ–∫ –∏ —è—Ä–º–∞—Ä–æ–∫',
  'üì± –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ü–∏—Ñ—Ä–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤',
  'üé• –ü–æ—Å–µ—â–µ–Ω–∏–µ –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä–∞ –Ω–∞ –æ–±—É—á–∞—é—â–∏–µ —Å–µ—Å—Å–∏–∏',
  'üß† –ò–≥—Ä—ã –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –ø–∞–º—è—Ç–∏ –∏ –≤–Ω–∏–º–∞–Ω–∏—è',
  'üåê –°–µ—Ç–µ–≤–æ–µ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å—Ç–≤–æ –∏–ª–∏ —É—á–∞—Å—Ç–∏–µ –≤ –æ–Ω–ª–∞–π–Ω-–ø—Ä–æ–µ–∫—Ç–∞—Ö',
  // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–¥–µ–∏
]


// –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏—é –∫–∞–∫ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É—é
module.exports = async (request, response) => {
  try {
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –±–æ—Ç–∞ —Å —Ç–æ–∫–µ–Ω–æ–º –æ—Ç BotFather
    const bot = new TelegramBot('6662031438:AAGGh0ZaoFbyDhrlUbr5dotx23QQDOySrUY')

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–ª–æ POST-–∑–∞–ø—Ä–æ—Å–∞ –æ—Ç Telegram
    const { body } = request

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ
    if (body.message) {
      const {
        chat: { id },
        text,
      } = body.message

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥—ã /q –¥–ª—è —Å–ª—É—á–∞–π–Ω–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
      if (text === '/q') {
        const randomIndex = Math.floor(Math.random() * questions.length)
        const question = questions[randomIndex]
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
        const message = `–í–∞—à –≤–æ–ø—Ä–æ—Å: *${question}* üëãüèª`
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ
        await bot.sendMessage(id, message, { parse_mode: 'Markdown' })
      }
      if (text === '/idea') {
        const randomIndex = Math.floor(Math.random() * ideasWithEmojis.length)
        const idea = ideasWithEmojis[randomIndex]
        // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
        const message = `–î–ª—è –≤–∞—Å –Ω–∞—à–ª–∞—Å—å –∏–¥–µ—è: *${idea}* üôå`
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ
        await bot.sendMessage(id, message, { parse_mode: 'Markdown' })
      }
    }
  } catch (error) {
    // –õ–æ–≥–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—å Vercel
    console.error('Error sending message')
    console.log(error.toString())
  }

  // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è Telegram
  response.send('OK')
}
